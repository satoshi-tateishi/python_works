<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>設定 - RFチャンネルリスト検索システム</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <nav class="bg-blue-600 text-white p-4 shadow-md flex justify-between items-center">
        <div class="flex items-baseline gap-2">
            <h1 class="text-xl font-bold">システム設定</h1>
            <span class="text-xs opacity-70">{{ version_str }}</span>
        </div>
        <a href="/" class="text-sm bg-blue-700 hover:bg-blue-800 px-3 py-1 rounded transition">戻る</a>
    </nav>

    <div class="container mx-auto p-4 max-w-2xl">
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-lg font-semibold mb-6 border-b pb-2">設定情報</h2>
            <form id="settings-form" class="space-y-8">
                <section>
                    <h3 class="text-md font-bold text-blue-600 mb-4 flex items-center"><span class="bg-blue-600 text-white w-1 h-5 mr-2"></span>会員情報</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-2 flex gap-2 items-end">
                            <div class="flex-1">
                                <label class="block text-xs font-medium text-gray-500 mb-1">会員番号</label>
                                <div class="flex items-center gap-2">
                                    <input type="text" id="member_num1" class="w-20 border p-2 rounded text-sm" maxlength="3">
                                    <span>-</span>
                                    <input type="text" id="member_num2" class="w-24 border p-2 rounded text-sm" maxlength="4">
                                </div>
                            </div>
                        </div>
                        <div class="col-span-2"><label class="block text-xs font-medium text-gray-500 mb-1">会員名</label><input type="text" id="member_name" class="w-full border p-2 rounded text-sm"></div>
                        <div><label class="block text-xs font-medium text-gray-500 mb-1">部署</label><input type="text" id="department" class="w-full border p-2 rounded text-sm"></div>
                        <div><label class="block text-xs font-medium text-gray-500 mb-1">運用担当者</label><input type="text" id="manager" class="w-full border p-2 rounded text-sm"></div>
                        <div><label class="block text-xs font-medium text-gray-500 mb-1">Tel</label><input type="text" id="member_tel" class="w-full border p-2 rounded text-sm"></div>
                        <div><label class="block text-xs font-medium text-gray-500 mb-1">E-mail</label><input type="email" id="member_email" class="w-full border p-2 rounded text-sm"></div>
                    </div>
                </section>
                <section>
                    <h3 class="text-md font-bold text-green-600 mb-4 flex items-center"><span class="bg-green-600 text-white w-1 h-5 mr-2"></span>現地使用者</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-xs font-medium text-gray-500 mb-1">氏名</label><input type="text" id="user_name" class="w-full border p-2 rounded text-sm"></div>
                        <div><label class="block text-xs font-medium text-gray-500 mb-1">ふりがな</label><input type="text" id="user_furigana" class="w-full border p-2 rounded text-sm"></div>
                        <div><label class="block text-xs font-medium text-gray-500 mb-1">Tel</label><input type="text" id="user_tel" class="w-full border p-2 rounded text-sm"></div>
                        <div><label class="block text-xs font-medium text-gray-500 mb-1">E-mail</label><input type="email" id="user_email" class="w-full border p-2 rounded text-sm"></div>
                    </div>
                </section>
                <div class="pt-6 border-t flex justify-between items-center">
                    <span id="save-status" class="text-sm text-green-600 font-bold opacity-0 transition-opacity">保存しました</span>
                    <button type="button" onclick="saveSettings()" class="bg-blue-600 text-white px-8 py-2 rounded-full hover:bg-blue-700 font-bold shadow-md transition">設定を保存</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        async function loadSettings() {
            const res = await fetch('/get_settings'); const data = await res.json();
            if (data.member) {
                document.getElementById('member_num1').value = data.member.member_num1 || '';
                document.getElementById('member_num2').value = data.member.member_num2 || '';
                document.getElementById('member_name').value = data.member.member_name || '';
                document.getElementById('department').value = data.member.department || '';
                document.getElementById('manager').value = data.member.manager || '';
                document.getElementById('member_tel').value = data.member.tel || '';
                document.getElementById('member_email').value = data.member.email || '';
            }
            if (data.user) {
                document.getElementById('user_name').value = data.user.name || '';
                document.getElementById('user_furigana').value = data.user.furigana || '';
                document.getElementById('user_tel').value = data.user.tel || '';
                document.getElementById('user_email').value = data.user.email || '';
            }
        }
        async function saveSettings() {
            const data = {
                member: {
                    member_num1: document.getElementById('member_num1').value, member_num2: document.getElementById('member_num2').value,
                    member_name: document.getElementById('member_name').value, department: document.getElementById('department').value,
                    manager: document.getElementById('manager').value, tel: document.getElementById('member_tel').value, email: document.getElementById('member_email').value
                },
                user: { name: document.getElementById('user_name').value, furigana: document.getElementById('user_furigana').value, tel: document.getElementById('user_tel').value, email: document.getElementById('user_email').value }
            };
            const res = await fetch('/save_settings', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
            if (res.ok) {
                const status = document.getElementById('save-status');
                status.classList.remove('opacity-0');
                setTimeout(() => status.classList.add('opacity-0'), 2000);
            }
        }
        window.onload = loadSettings;
    </script>
</body>
</html>
Requirements definition document (Updated: 2026-02-02)

1. システムの目的
macOS上でスタンドアロンアプリケーション（WebView版）として動作し、1.3万件の施設データから運用候補地を選定、ガードバンド等の専門的制約を自動計算した上で、Excelの報告書およびSennheiser WSM連携用CSVを作成する。ブラウザ不要で、直感的なデスクトップアプリとして運用可能とする。

2. データベース・データ仕様 (SQLite)
テーブル: 
- venues: 施設情報、各CHの運用可否（○/空白）。
- tv_channels: 日本のTVチャンネル（13-53CH）の下限・上限周波数。
- devices: 運用機器（送信機/受信機）の対応周波数範囲。
- member_info / onsite_user: 申請者・運用者情報。

データ特性:
- 13CH〜53CHの各列において、「○」は運用可能、「空白（NULL）」は運用不可。
- 53CH（ラジオマイク専用帯）は全施設に「○」を付与。

3. アプリケーション機能
① 検索・キープ機能
- 高速検索: 施設名、住所、都道府県から部分一致検索（正規化判定）。
- キープリスト保持: 候補施設を一時保存。
- ドラッグ＆ドロップ並べ替え: SortableJSにより、キープした施設の順序を直感的に入れ替え可能。この順序はExcel出力に反映される。

② 運用調整・チャンネル選択機能
- 個別チャンネル選択: 施設ごとに使用CHを選択。
- ガードバンド（GB）自動判定:
  - 隣接CHの運用可否に基づき、境界線を「可能側」に1MHz移動。全CHが隙間なくシームレスに連結される。
  - 13CH下限、53CH上限には適用しない。
- 機器適合視覚化: EM 3732 L/N, SR2050 IEM 等の運用可能範囲をカラーラインで表示。全CHで垂直位置を固定し、視認性を向上。

③ ファイル保存機能（ネイティブ連動）
- macOS標準保存ダイアログ: ブラウザのダウンロード機能に頼らず、OS標準のダイアログを表示。
- デフォルト保存先: 「デスクトップ」を初期保存先として指定。
- ファイル名規則: `運用連絡票_YYYY-MMDD.xlsx` または `wsm_施設名_YYYY-MMDD.csv`。

④ バージョン管理
- 形式: `v[App版]_[データ日付]`（例: v1.0.0_20250831）。全画面のタイトル横に常時表示。

4. 技術スタック
- Backend: Python 3.12.3 / Flask
- UI/Window: pywebview (macOS WebKit)
- Database: SQLite
- Frontend: Tailwind CSS / SortableJS
- Packaging: PyInstaller

5. 起動・構築方法
- 開発時起動: rf_unyo/.venv/bin/python rf_unyo/ch_list/app.py
- アプリビルド: rf_unyo/.venv/bin/python rf_unyo/ch_list/data_source/build_app.py
- データ更新: rf_unyo/.venv/bin/python rf_unyo/ch_list/data_source/update_db.py

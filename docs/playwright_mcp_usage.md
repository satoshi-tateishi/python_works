# Playwright MCP 使用方法

このドキュメントでは、Gemini CLI で Playwright MCP サーバーを使用してブラウザ操作を行う方法について説明します。

## 概要

Playwright MCP サーバーを使用すると、Gemini エージェントがブラウザを制御し、ウェブページの閲覧、検索、クリック、入力などの操作を行うことができます。これにより、リアルタイムのウェブ情報へのアクセスや、ウェブベースのタスクの自動化が可能になります。

## 前提条件

`.gemini/settings.json` に Playwright MCP サーバーが正しく設定されている必要があります。

```json
{
  "mcpServers": {
    "playwright": {
      "command": "npx",
      "args": [
        "@playwright/mcp@latest"
      ]
    }
  }
}
```

## 使用可能な主なツール

Playwright MCP は以下のツールを提供します（ツール名は環境により異なる場合がありますが、主な機能は以下の通りです）。

### 1. ナビゲーション (`browser_navigate`)
指定した URL にアクセスします。

**例:** Google のトップページにアクセスする
- **Tool:** `browser_navigate`
- **Args:** `{"url": "https://www.google.com"}`

### 2. クリック (`browser_click`)
ページ上の要素をクリックします。`ref` (要素参照ID) を指定して操作します。`ref` は、ナビゲーションやスナップショット取得時の出力に含まれる `snapshot` 情報から取得します。

**例:** 検索結果のリンクをクリックする
- **Tool:** `browser_click`
- **Args:** `{"ref": "e148"}`

### 3. 入力 (`browser_type`)
テキストボックスなどの入力フィールドにテキストを入力します。`submit: true` を指定すると、入力後に Enter キーを押す動作（フォーム送信など）を行います。

**例:** 検索ボックスに "Yahoo Japan" と入力して検索する
- **Tool:** `browser_type`
- **Args:** `{"ref": "e42", "text": "Yahoo Japan", "submit": true}`

### 4. スナップショット取得 (`browser_snapshot`)
現在のページの構造（アクセシビリティツリー）を取得します。要素の `ref` ID を確認するために重要です。通常、ナビゲーション操作の後に自動的に出力されます。

### 5. スクリーンショット (`browser_take_screenshot`)
ページのスクリーンショットを画像ファイルとして保存します。

## 基本的なワークフロー

1.  **ページへのアクセス**: `browser_navigate` で目的のサイトを開きます。
2.  **要素の特定**: ツールの出力（Snapshot）を確認し、操作したい要素（リンク、ボタン、入力欄）の `ref` ID を見つけます。
3.  **アクションの実行**: `browser_click` や `browser_type` を使用して、特定した `ref` に対して操作を行います。
4.  **確認**: 操作後のページの状態（新しい Snapshot）を確認し、次のアクションへ進みます。

## 注意事項

- **要素参照 (ref)**: `ref` ID はページの状態が変わるたび（リロードや遷移など）に変わる可能性があります。必ず直前の操作結果に含まれる Snapshot の最新の `ref` を使用してください。
- **エラーハンドリング**: 操作が失敗した場合（例：要素が見つからない）、エラーメッセージを確認し、再度 Snapshot を取得して正しい `ref` を確認するか、別の操作を試みてください。
